<!DOCTYPE html>
<html>
<head>
    <title>Sales Call Analytics Tool</title>
    <!-- Include Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .blue-header {
            background-color: #4f04d1;
        }
        .form-control-small {
            width: 50%;
        }
        .form-control-medium {
            width: 70%;
        }
        .form-control-large {
            width: 93%;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark blue-header">
        <a class="navbar-brand" href="#">Sales Call Analytics Tool</a>
    </nav>
    <div class="container mt-4">
        <h2> Search Call Records</h2>
        <form id="filterForm">
            <div class="form-row">
                <div class="form-group col-md-3">
                    <label for="date_from"><b>Date From:</b></label>
                    <input type="date" class="form-control form-control-medium" id="date_from">
                </div>
                <div class="form-group col-md-3">
                    <label for="date_to"><b>Date To:</b></label>
                    <input type="date" class="form-control form-control-medium" id="date_to">
                </div>
                <div class="form-group col-md-3">
                    <label for="language"><b>Language:</b></label>
                    <select class="form-control form-control-medium" id="language">
                        <option value="all">All</option>
                        <option value="bengali">Bengali</option>
                        <option value="english">English</option>
                        <option value="hindi">Hindi</option>
                    </select>
                </div>
                <div class="form-group col-md-3">
                    <label for="agent"><b>Agent:</b></label>
                    <select class="form-control form-control-medium" id="agent">
                        <option value="all">All</option>
                        {% for agent_id, agent_name in agents %}
                        <option value="{{ agent_id }}">{{ agent_name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="keywords"><b>Keywords:</b></label>
                <input type="text" class="form-control form-control-large" id="keywords" placeholder="Enter keywords separated by comma">
            </div>
            <button type="button" class="btn btn-primary" id="filterButton">Filter</button>
        </form>
    </div>
    <div class="container mt-4">
        <div class="table-responsive" style="max-height: 300px; overflow-y: scroll; width: 95%;">
        <table class="table table-striped table-bordered">
            <thead class="thead-dark text-center" style="position: sticky; top: 0;">
                <tr>
                    <th>Call Timestamp</th>
                    <th>Customer ID</th>
                    <th>Agent Name</th>
                    <th>Call Language</th>
                    <th>Call Duration</th>
                    <th>Followup Required</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for call in call_records %}
                <tr class="text-center">
                    <td>{{ call[5] }}</td>
                    <td>{{ call[1] }}</td>
                    <td>{{ call[2] }}</td>
                    <td>{{ call[3] }}</td>
                    <td>{{ call[4] }}</td>
                    <td>{{ call[6] }}</td>
                    <td><button class="btn btn-primary" value="{{ call[0] }}" id="btn_call_select">Select</button></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
    </div>
    <!-- Include Bootstrap JS and jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        // Populate Agent dropdown with values from Flask API
        $(document).ready(function () {
            $.ajax({
                url: '/agents',  // Flask route to get agents
                type: 'GET',
                success: function (data) {
                    const agentDropdown = $('#agent');
                    for (const agent of data) {
                        agentDropdown.append($('<option>', {
                            value: agent.agent_id,
                            text: agent.agent_name
                        }));
                    }
                }
            });
        });

        // Add a click event to the Filter button
        $('#filterButton').on('click', function () {
            const date_from = $('#date_from').val();
            const date_to = $('#date_to').val();
            const language = $('#language').val();
            const agent = $('#agent').val();
            const keywords = $('#keywords').val();

            // Create a JSON object with the input data
            const data = {
                date_from: date_from,
                date_to: date_to,
                language: language,
                agent: agent,
                keywords: keywords
            };

            // Send a POST request with JSON data to Flask API
            $.ajax({
                url: '/filter_records',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (response) {
                    alert(response.message);
                    console.log(response.criteria);
                    // You can update the UI with the filtered data here
                }
            });
        });
    </script>
</body>
</html>
